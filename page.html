<!DOCTYPE html>
{% autoescape true %}
<html lang="en-GB">
	<head>
		<title>{{topic.name}} | bubl | Smart Photo Sharing</title>
		<meta name="viewport" content="width=400, user-scalable=no" />
		<link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" />
		<!--<link href="css/flat-ui.css" rel="stylesheet" />-->
		<link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>
		<link href="css/style.css" rel="stylesheet" />
		<link href="css/lightbox.css" rel="stylesheet" />
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.js"></script>
		<!--<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>-->
		<script src="js/topic-page.js"></script>
		<script src="js/lightbox-2.6.min.js"></script>
	</head>
	<body>
		<div class="container">
			<div class="hero-unit">
				<div class="user-box">
					{% if user %}
						Hello, {{user.name}} |
						<a href="/logout?topic_url={{topic.url}}">Logout</a>
					{% else %}
						<a href="/login?topic_url={{topic.url}}">Login</a>
					{% endif %}
				</div>
				<h1>
					<a href="/">
						bubl
					</a>
					<span class="topic_title">
						{{topic.name}}
					</span>
				</h1>
				<span class="creator_label">
					Created by {{topic.creator_name}}
				</span>
				{% if user %}
				<button class="add-image-btn btn">Add an image</button>
				{% endif %}
			</div>
			<div class="bubls-body">
				{% if user %}
					<form class="upload-form" method="POST" action="./{{topic.url}}/add_image" 
						enctype="multipart/form-data" accept-charset="UTF-8">
						<label>
							<input type="radio" class="type-select" name="image_type" value="file" checked />
							Upload an image
						</label>
						<label>
							<input type="radio" class="type-select" name="image_type" value="url" />
							Add image from a URL
						</label>
						<div class="form-control file-input">Click to choose a file</div>
						<input type="file" class="file-upload" name="image" accept="image/*" />
						<input type="text" class="form-control url-input" name="image_url" placeholder="Image URL" />
						<input type="text" class="form-control" name="image_caption" placeholder="Caption" />
						<input type="submit" class="btn" value="Upload" />
					</form>
				{% endif %}
				
				{% for image in images recursive %}
					{% if image and image.url %}
						<div class="image-bubl span3" id="{{image.key}}">
							<a href="{{image.url}}" data-lightbox="{{image.key}}" title="{{image.caption}}">
								<img src="{{image.thumb_url}}" alt="{{image.caption}}" />
								<div class="caption">
									{{image.caption}}
								</div>
							</a>
							<div class="vote-buttons">
								<div class="score">
									{{image.score}}
								</div>
								{% if user %}
									<div class="downvote {% if user.id in image.downvoters %}active{% endif %}">
										&#8681;
									</div>
									<div class="upvote {% if user.id in image.upvoters %}active{% endif %}">
										&#8679;
									</div>
									{% if user.id == image.creator_id %}
										<div class="delete-image">
											X
										</div>
									{% endif %}
								{% endif %}
							</div>
						</div>
						
					{% elif image and image is sequence %}
						<div class="column">
							{{loop(image)}}
						</div>
					{% endif %}
				{% endfor %}
				<div class="confirm-delete-template">
					<div class="confirm-delete-box">
						<div>Permanently delete this image?</div>
						<button class="btn cancel-delete">Cancel</button>
						<button class="btn confirm-delete">Delete</button>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
{% endautoescape %}